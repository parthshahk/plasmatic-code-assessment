service: petstore
frameworkVersion: "3"

custom:
    pets: "pets-${sls:stage}"
    orders: "orders-${sls:stage}"
    inventory: "inventory-${sls:stage}"

provider:
    name: aws
    runtime: nodejs14.x
    stage: dev
    region: ca-central-1
    iam:
        role:
            statements:
                - Effect: Allow
                  Action:
                      - dynamodb:Query
                      - dynamodb:Scan
                      - dynamodb:GetItem
                      - dynamodb:PutItem
                      - dynamodb:UpdateItem
                      - dynamodb:DeleteItem
                  Resource:
                      - Fn::GetAtt: [InventoryTable, Arn]
                      - Fn::GetAtt: [OrderTable, Arn]
                      - Fn::GetAtt: [PetTable, Arn]

functions:
    pet:
        handler: handler.handler
        events:
            - httpApi:
                  path: /pet/{any+}
                  method: ANY
    store:
        handler: handler.handler
        events:
            - httpApi:
                  path: /store/{any+}
                  method: ANY

resources:
    Resources:
        PetTable:
            Type: AWS::DynamoDB::Table
            Properties:
                AttributeDefinitions:
                    - AttributeName: id
                      AttributeType: N
                KeySchema:
                    - AttributeName: id
                      KeyType: HASH
                BillingMode: PAY_PER_REQUEST
                TableName: ${self:custom.pets}
        OrderTable:
            Type: AWS::DynamoDB::Table
            Properties:
                AttributeDefinitions:
                    - AttributeName: id
                      AttributeType: N
                KeySchema:
                    - AttributeName: id
                      KeyType: HASH
                BillingMode: PAY_PER_REQUEST
                TableName: ${self:custom.orders}
        InventoryTable:
            Type: AWS::DynamoDB::Table
            Properties:
                AttributeDefinitions:
                    - AttributeName: id
                      AttributeType: N
                KeySchema:
                    - AttributeName: id
                      KeyType: HASH
                BillingMode: PAY_PER_REQUEST
                TableName: ${self:custom.inventory}
